<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشغل فيديوهات يوتيوب</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        h1 {
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #000;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .controls button {
            min-width: 80px;
            margin: 0 5px;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .playlist {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
        }
        
        .playlist-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .playlist-item:hover {
            background-color: #f5f5f5;
        }
        
        .playlist-item.active {
            background-color: #e3f2fd;
            border-right: 4px solid #2196F3;
        }
        
        .playlist-item img {
            width: 120px;
            height: 68px;
            margin-left: 15px;
            border-radius: 4px;
            object-fit: cover;
        }
        
        .playlist-item .video-info {
            flex-grow: 1;
        }
        
        .playlist-item .video-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .playlist-item .video-channel {
            font-size: 0.9em;
            color: #666;
        }
        
        .add-video-form {
            margin-top: 20px;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }
        
        .add-video-form input {
            direction: ltr;
            text-align: left;
        }
        
        @media (max-width: 768px) {
            .playlist-item {
                flex-direction: column;
                text-align: center;
            }
            
            .playlist-item img {
                margin-left: 0;
                margin-bottom: 10px;
            }
            
            .controls {
                flex-direction: row;
            }
            
            .controls button {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>مشغل فيديوهات يوتيوب</h1>
        
        <div class="video-container">
            <div id="player"></div>
        </div>
        
        <div class="controls">
            <button id="prev-btn" class="btn btn-info"><i class="fas fa-step-backward"></i> السابق</button>
            <button id="play-btn" class="btn btn-success"><i class="fas fa-play"></i> تشغيل</button>
            <button id="pause-btn" class="btn btn-warning"><i class="fas fa-pause"></i> إيقاف مؤقت</button>
            <button id="next-btn" class="btn btn-info">التالي <i class="fas fa-step-forward"></i></button>
            <button id="mute-btn" class="btn btn-secondary"><i class="fas fa-volume-mute"></i> كتم الصوت</button>
        </div>
        
        <div class="add-video-form">
            <h3>إضافة فيديو جديد</h3>
            <div class="input-group mb-3">
                <input type="text" id="video-url" class="form-control" placeholder="أدخل رابط فيديو يوتيوب أو معرف الفيديو" aria-label="رابط فيديو يوتيوب">
                <button class="btn btn-primary" type="button" id="add-video-btn">إضافة</button>
            </div>
        </div>
        
        <h3>قائمة التشغيل</h3>
        <div class="playlist" id="playlist">
            <!-- ستتم إضافة عناصر قائمة التشغيل هنا عن طريق جافا سكريبت -->
        </div>
    </div>

    <!-- تضمين Font Awesome للأيقونات -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <!-- تضمين خط Tajawal -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap">
    
    <script>
        // قائمة تشغيل افتراضية
        const defaultPlaylist = [
            { id: 'jNQXAC9IVRw', title: 'فيديو يوتيوب الأول', channel: 'يوتيوب الرسمي' },
            { id: 'dQw4w9WgXcQ', title: 'Rick Astley - Never Gonna Give You Up', channel: 'Rick Astley' },
            { id: 'xvFZjo5PgG0', title: 'مثال فيديو يوتيوب', channel: 'Duran Duran' },
            { id: 'LXb3EKWsInQ', title: 'فيديو آخر للتجربة', channel: 'قناة تجريبية' }
        ];

        let playlist = [...defaultPlaylist];
        let currentVideoIndex = 0;
        let player;
        
        // تحميل YouTube API
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        
        // إنشاء مشغل يوتيوب عند جاهزية API
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '390',
                width: '640',
                videoId: playlist[currentVideoIndex].id,
                playerVars: {
                    'playsinline': 1,
                    'enablejsapi': 1,
                    'origin': window.location.origin,
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }
        
        // عند جاهزية المشغل
        function onPlayerReady(event) {
            renderPlaylist();
            updateActiveVideo();
        }
        
        // عندما يتغير حالة المشغل (تشغيل، إيقاف، إنتهاء...)
        function onPlayerStateChange(event) {
            // عند انتهاء الفيديو (حالة = 0)، انتقل إلى الفيديو التالي
            if (event.data === YT.PlayerState.ENDED) {
                playNextVideo();
            }
        }
        
        // تحميل وعرض قائمة التشغيل
        function renderPlaylist() {
            const playlistElement = document.getElementById('playlist');
            playlistElement.innerHTML = '';
            
            playlist.forEach((video, index) => {
                const videoElement = document.createElement('div');
                videoElement.className = `playlist-item ${index === currentVideoIndex ? 'active' : ''}`;
                videoElement.innerHTML = `
                    <img src="https://img.youtube.com/vi/${video.id}/mqdefault.jpg" alt="${video.title}">
                    <div class="video-info">
                        <div class="video-title">${video.title}</div>
                        <div class="video-channel">${video.channel}</div>
                    </div>
                `;
                
                videoElement.addEventListener('click', () => {
                    currentVideoIndex = index;
                    playVideo(video.id);
                    updateActiveVideo();
                });
                
                playlistElement.appendChild(videoElement);
            });
        }
        
        // تحديث الفيديو النشط في قائمة التشغيل
        function updateActiveVideo() {
            const playlistItems = document.querySelectorAll('.playlist-item');
            playlistItems.forEach((item, index) => {
                if (index === currentVideoIndex) {
                    item.classList.add('active');
                    // تمرير إلى الفيديو النشط
                    item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    item.classList.remove('active');
                }
            });
        }
        
        // تشغيل فيديو معين
        function playVideo(videoId) {
            player.loadVideoById(videoId);
        }
        
        // الانتقال إلى الفيديو التالي
        function playNextVideo() {
            if (currentVideoIndex < playlist.length - 1) {
                currentVideoIndex++;
            } else {
                currentVideoIndex = 0; // العودة إلى بداية القائمة عند الوصول للنهاية
            }
            
            playVideo(playlist[currentVideoIndex].id);
            updateActiveVideo();
        }
        
        // الانتقال إلى الفيديو السابق
        function playPrevVideo() {
            if (currentVideoIndex > 0) {
                currentVideoIndex--;
            } else {
                currentVideoIndex = playlist.length - 1; // الانتقال إلى نهاية القائمة عند الضغط على السابق من البداية
            }
            
            playVideo(playlist[currentVideoIndex].id);
            updateActiveVideo();
        }
        
        // استخراج معرف الفيديو من رابط يوتيوب
        function extractVideoId(url) {
            // التحقق أولاً إذا كان المدخل هو معرف فيديو فقط
            if (url.length === 11) {
                return url;
            }
            
            // محاولة استخراج المعرف من الرابط
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : null;
        }
        
        // إضافة فيديو جديد إلى قائمة التشغيل
        function addVideoToPlaylist() {
            const videoUrlInput = document.getElementById('video-url');
            const url = videoUrlInput.value.trim();
            
            if (!url) {
                alert('الرجاء إدخال رابط فيديو صالح');
                return;
            }
            
            const videoId = extractVideoId(url);
            
            if (!videoId) {
                alert('لم نتمكن من استخراج معرف الفيديو من الرابط الذي أدخلته، الرجاء التأكد من صحة الرابط');
                return;
            }
            
            // التحقق من عدم وجود الفيديو مسبقاً في القائمة
            if (playlist.some(video => video.id === videoId)) {
                alert('هذا الفيديو موجود بالفعل في قائمة التشغيل');
                videoUrlInput.value = '';
                return;
            }
            
            // إضافة الفيديو إلى قائمة التشغيل
            playlist.push({
                id: videoId,
                title: 'فيديو جديد', // عنوان مبدئي
                channel: 'قناة غير محددة' // اسم قناة مبدئي
            });
            
            // تحديث عرض قائمة التشغيل
            renderPlaylist();
            videoUrlInput.value = '';
            
            // إذا كان هذا أول فيديو في القائمة، قم بتشغيله
            if (playlist.length === 1) {
                currentVideoIndex = 0;
                playVideo(videoId);
            }
        }
        
        // إضافة مستمعي الأحداث عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', () => {
            // أزرار التحكم
            document.getElementById('play-btn').addEventListener('click', () => {
                player.playVideo();
            });
            
            document.getElementById('pause-btn').addEventListener('click', () => {
                player.pauseVideo();
            });
            
            document.getElementById('next-btn').addEventListener('click', () => {
                playNextVideo();
            });
            
            document.getElementById('prev-btn').addEventListener('click', () => {
                playPrevVideo();
            });
            
            document.getElementById('mute-btn').addEventListener('click', () => {
                if (player.isMuted()) {
                    player.unMute();
                    document.getElementById('mute-btn').innerHTML = '<i class="fas fa-volume-mute"></i> كتم الصوت';
                } else {
                    player.mute();
                    document.getElementById('mute-btn').innerHTML = '<i class="fas fa-volume-up"></i> تشغيل الصوت';
                }
            });
            
            // إضافة فيديو جديد
            document.getElementById('add-video-btn').addEventListener('click', addVideoToPlaylist);
            document.getElementById('video-url').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addVideoToPlaylist();
                }
            });
        });
    </script>
</body>
</html>
