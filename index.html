<!DOCTYPE html>  
<html lang="ar" dir="rtl" data-lang="ar">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <meta name="description" content="ŸÖŸÜÿµÿ© ÿ®ÿ´ ŸÅŸäÿØŸäŸà ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÖÿπ ŸÜÿ∏ÿßŸÖ ÿØÿ®ŸÑÿ¨ÿ© ŸÖÿ™ÿπÿØÿØÿ© ÿßŸÑŸÑÿ∫ÿßÿ™">  
    <title>Watch VIP - ŸÖŸÜÿµÿ© ÿßŸÑÿ®ÿ´</title>  
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">  

<style>  
    * {  
        margin: 0;  
        padding: 0;  
        box-sizing: border-box;  
    }  

    :root {  
        --primary-color: #ff0000;  
        --secondary-color: #282828;  
        --bg-dark: #0f0f0f;  
        --bg-light: #1f1f1f;  
        --text-primary: #ffffff;  
        --text-secondary: #aaaaaa;  
        --border-color: #303030;  
        --success-color: #00ff00;  
        --verified-color: #1da1f2;  
        --shadow: 0 2px 10px rgba(0,0,0,0.3);  
    }  

    html[data-lang="ar"] body {  
        font-family: 'Cairo', sans-serif;  
        direction: rtl;  
    }  

    html[data-lang="en"] body,  
    html[data-lang="fr"] body {  
        font-family: 'Inter', sans-serif;  
        direction: ltr;  
    }  

    html[data-lang="ja"] body {  
        font-family: 'Noto Sans JP', sans-serif;  
        direction: ltr;  
    }  

    body {  
        background-color: var(--bg-dark);  
        color: var(--text-primary);  
        line-height: 1.6;  
        min-height: 100vh;  
    }  

    .container {  
        max-width: 1200px;  
        margin: 0 auto;  
        padding: 20px;  
    }  

    .breadcrumb {  
        display: flex;  
        align-items: center;  
        gap: 10px;  
        margin-bottom: 20px;  
        padding: 10px 15px;  
        background: var(--bg-light);  
        border-radius: 6px;  
        font-size: 0.9rem;  
    }  

    .breadcrumb button {  
        background: var(--secondary-color);  
        border: 1px solid var(--border-color);  
        color: var(--verified-color);  
        cursor: pointer;  
        text-decoration: none;  
        padding: 8px 15px;  
        border-radius: 6px;  
        transition: all 0.3s;  
        font-size: 0.9rem;  
        font-family: inherit;  
    }  

    .breadcrumb button:hover {  
        background: var(--primary-color);  
        color: var(--text-primary);  
        border-color: var(--primary-color);  
    }  

    .library-view {  
        margin-bottom: 30px;  
    }  

    .library-header {  
        padding: 15px 20px;  
        background: var(--secondary-color);  
        border-radius: 12px 12px 0 0;  
        border-bottom: 1px solid var(--border-color);  
    }  

    .library-header h1 {  
        font-size: 1.5rem;  
        font-weight: 600;  
    }  

    .library-grid {  
        display: grid;  
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));  
        gap: 20px;  
        padding: 20px;  
        background: var(--bg-light);  
        border-radius: 0 0 12px 12px;  
    }  

    .library-item {  
        cursor: pointer;  
        transition: all 0.3s;  
        border-radius: 8px;  
        overflow: hidden;  
        background: var(--secondary-color);  
        border: 2px solid transparent;  
    }  

    .library-item:hover {  
        border-color: var(--primary-color);  
        transform: translateY(-5px);  
        box-shadow: var(--shadow);  
    }  

    .item-cover {  
        width: 100%;  
        aspect-ratio: 16/9;  
        background: linear-gradient(135deg, #ff0000, #cc0000);  
        display: flex;  
        align-items: center;  
        justify-content: center;  
        font-size: 3rem;  
        color: white;  
        position: relative;  
        overflow: hidden;  
    }  

    .item-cover.episode {  
        aspect-ratio: 2/1;  
    }  

    .item-cover img {  
        width: 100%;  
        height: 100%;  
        object-fit: cover;  
    }  

    .item-info {  
        padding: 15px;  
    }  

    .item-title {  
        font-weight: 600;  
        margin-bottom: 8px;  
        overflow: hidden;  
        text-overflow: ellipsis;  
        white-space: nowrap;  
    }  

    .item-subtitle {  
        font-size: 0.85rem;  
        color: var(--text-secondary);  
    }  

    .video-section {  
        background: var(--bg-light);  
        border-radius: 12px;  
        overflow: hidden;  
        margin-bottom: 30px;  
        box-shadow: var(--shadow);  
    }  

    .video-header {  
        padding: 15px 20px;  
        background: var(--secondary-color);  
        border-bottom: 1px solid var(--border-color);  
        display: flex;  
        justify-content: space-between;  
        align-items: center;  
        flex-wrap: wrap;  
        gap: 15px;  
    }  

    .video-header h1 {  
        font-size: 1.5rem;  
        font-weight: 600;  
        flex: 1;  
    }  

    .video-controls {  
        display: flex;  
        align-items: center;  
        gap: 10px;  
    }  

    .video-container {  
        position: relative;  
        padding-bottom: 56.25%;  
        height: 0;  
        overflow: hidden;  
        background: #000;  
    }  

    .video-container iframe {  
        position: absolute;  
        top: 0;  
        left: 0;  
        width: 100%;  
        height: 100%;  
        border: none;  
    }  

    .quick-toggle {  
        display: flex;  
        align-items: center;  
        gap: 10px;  
    }  

    .sys-toggle {  
        width: 50px;  
        height: 50px;  
        border-radius: 50%;  
        border: none;  
        background: #2a2a2a;  
        color: #aaa;  
        font-size: 20px;  
        cursor: pointer;  
        display: flex;  
        align-items: center;  
        justify-content: center;  
        transition: all 0.25s ease;  
        box-shadow: inset 0 0 0 2px #333;  
        font-family: inherit;  
        user-select: none;  
    }  

    .sys-toggle:hover {  
        background: #333;  
    }  

    .sys-toggle.active {  
        background: var(--primary-color);  
        color: #fff;  
        box-shadow: 0 0 12px rgba(255, 0, 0, 0.6), inset 0 0 0 2px rgba(255,255,255,0.3);  
    }  

    .sys-toggle .icon {  
        pointer-events: none;  
    }  

    .dub-selector {  
        background: var(--secondary-color);  
        padding: 20px;  
        border-bottom: 1px solid var(--border-color);  
        margin-bottom: 0;  
        animation: slideDown 0.3s ease-out;  
    }  

    @keyframes slideDown {  
        from {  
            opacity: 0;  
            max-height: 0;  
            overflow: hidden;  
        }  
        to {  
            opacity: 1;  
            max-height: 1000px;  
        }  
    }  

    .dub-selector h3 {  
        margin-bottom: 12px;  
        font-size: 0.95rem;  
        color: var(--text-secondary);  
        font-weight: 500;  
    }  

    .dub-buttons {  
        display: flex;  
        gap: 10px;  
        flex-wrap: wrap;  
        margin-bottom: 15px;  
    }  

    .dub-btn {  
        padding: 10px 18px;  
        background: var(--bg-dark);  
        border: 2px solid var(--border-color);  
        color: var(--text-primary);  
        border-radius: 8px;  
        cursor: pointer;  
        font-size: 0.9rem;  
        font-weight: 500;  
        transition: all 0.3s;  
        font-family: inherit;  
        display: flex;  
        align-items: center;  
        gap: 6px;  
    }  

    .dub-btn:hover {  
        border-color: var(--text-secondary);  
        background: var(--bg-light);  
    }  

    .dub-btn.active {  
        border-color: var(--primary-color);  
        background: var(--primary-color);  
        color: var(--text-primary);  
        font-weight: 600;  
        box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);  
    }  

    .dub-icon {  
        font-size: 1.1rem;  
    }  

    .delay-control {  
        background: rgba(255, 0, 0, 0.05);  
        border: 1px solid rgba(255, 0, 0, 0.2);  
        padding: 15px;  
        border-radius: 8px;  
        margin-bottom: 15px;  
    }  

    .delay-control.hidden {  
        display: none;  
    }  

    .delay-label {  
        display: flex;  
        justify-content: space-between;  
        align-items: center;  
        margin-bottom: 10px;  
        font-size: 0.9rem;  
        color: var(--text-secondary);  
    }  

    .delay-value {  
        color: var(--primary-color);  
        font-weight: 600;  
        font-size: 1.1rem;  
    }  

    .sync-controls {  
        display: flex;  
        align-items: center;  
        gap: 12px;  
        margin-bottom: 12px;  
    }  

    .sync-btn {  
        width: 36px;  
        height: 36px;  
        border-radius: 6px;  
        border: 2px solid var(--border-color);  
        background: var(--bg-dark);  
        color: var(--text-primary);  
        cursor: pointer;  
        display: flex;  
        align-items: center;  
        justify-content: center;  
        font-size: 1rem;  
        transition: all 0.2s;  
        font-family: inherit;  
        font-weight: 600;  
    }  

    .sync-btn:hover {  
        border-color: var(--primary-color);  
        background: var(--bg-light);  
    }  

    .sync-btn:active {  
        transform: scale(0.95);  
    }  

    .delay-slider {  
        flex: 1;  
        height: 6px;  
        border-radius: 3px;  
        background: var(--bg-dark);  
        outline: none;  
        -webkit-appearance: none;  
        appearance: none;  
        cursor: pointer;  
    }  

    .delay-slider::-webkit-slider-thumb {  
        -webkit-appearance: none;  
        appearance: none;  
        width: 16px;  
        height: 16px;  
        border-radius: 50%;  
        background: var(--primary-color);  
        cursor: pointer;  
        transition: all 0.2s;  
        box-shadow: 0 0 8px rgba(255, 0, 0, 0.4);  
    }  

    .delay-slider::-webkit-slider-thumb:hover {  
        transform: scale(1.2);  
        box-shadow: 0 0 12px rgba(255, 0, 0, 0.6);  
    }  

    .delay-slider::-moz-range-thumb {  
        width: 16px;  
        height: 16px;  
        border-radius: 50%;  
        background: var(--primary-color);  
        cursor: pointer;  
        border: none;  
        transition: all 0.2s;  
        box-shadow: 0 0 8px rgba(255, 0, 0, 0.4);  
    }  

    .delay-slider::-moz-range-thumb:hover {  
        transform: scale(1.2);  
        box-shadow: 0 0 12px rgba(255, 0, 0, 0.6);  
    }  

    .delay-hint {  
        font-size: 0.8rem;  
        color: var(--text-secondary);  
        margin-top: 8px;  
    }  

    .sync-indicator {  
        display: inline-flex;  
        align-items: center;  
        gap: 8px;  
        padding: 8px 12px;  
        background: rgba(0, 255, 0, 0.1);  
        border-radius: 4px;  
        font-size: 0.8rem;  
        color: var(--success-color);  
    }  

    .sync-indicator.syncing {  
        background: rgba(255, 0, 0, 0.1);  
        color: var(--primary-color);  
    }  

    .sync-dot {  
        width: 6px;  
        height: 6px;  
        border-radius: 50%;  
        background: var(--success-color);  
    }  

    .sync-dot.syncing {  
        background: var(--primary-color);  
        animation: pulse 0.8s ease-in-out infinite;  
    }  

    .dub-status-indicator {  
        display: flex;  
        align-items: center;  
        gap: 10px;  
        padding: 12px 15px;  
        background: rgba(255, 0, 0, 0.1);  
        border-radius: 6px;  
        margin-top: 15px;  
        font-size: 0.9rem;  
        color: #ff0000;  
        border: 1px solid rgba(255, 0, 0, 0.2);  
    }  

    .dub-status-dot {  
        display: inline-block;  
        width: 8px;  
        height: 8px;  
        background: #aaa;  
        border-radius: 50%;  
    }  

    .dub-status-dot.active {  
        background: var(--success-color);  
        animation: pulse 1.5s ease-in-out infinite;  
    }  

    .video-info {  
        padding: 20px;  
    }  

    .video-title {  
        font-size: 1.3rem;  
        margin-bottom: 10px;  
        font-weight: 600;  
    }  

    .video-description {  
        color: var(--text-secondary);  
        font-size: 0.95rem;  
    }  

    .comments-section {  
        background: var(--bg-light);  
        border-radius: 12px;  
        padding: 20px;  
        box-shadow: var(--shadow);  
    }  

    .comments-header {  
        display: flex;  
        align-items: center;  
        justify-content: space-between;  
        margin-bottom: 20px;  
        padding-bottom: 15px;  
        border-bottom: 1px solid var(--border-color);  
    }  

    .comments-header h2 {  
        font-size: 1.4rem;  
        font-weight: 600;  
    }  

    .comments-count {  
        background: var(--secondary-color);  
        padding: 5px 12px;  
        border-radius: 20px;  
        font-size: 0.9rem;  
        color: var(--text-secondary);  
    }  

    .comment-form {  
        margin-bottom: 30px;  
        padding: 20px;  
        background: var(--secondary-color);  
        border-radius: 8px;  
    }  

    .form-group {  
        margin-bottom: 15px;  
    }  

    .form-group label {  
        display: block;  
        margin-bottom: 8px;  
        color: var(--text-secondary);  
        font-size: 0.9rem;  
        font-weight: 500;  
    }  

    .form-group input,  
    .form-group textarea {  
        width: 100%;  
        padding: 12px 15px;  
        background: var(--bg-dark);  
        border: 1px solid var(--border-color);  
        border-radius: 6px;  
        color: var(--text-primary);  
        font-size: 0.95rem;  
        font-family: inherit;  
        transition: border-color 0.3s;  
    }  

    .form-group input::placeholder,  
    .form-group textarea::placeholder {  
        color: var(--text-secondary);  
    }  

    .form-group input:focus,  
    .form-group textarea:focus {  
        outline: none;  
        border-color: var(--primary-color);  
        background: var(--bg-dark);  
    }  

    .form-group textarea {  
        resize: vertical;  
        min-height: 100px;  
    }  

    .form-hint {  
        font-size: 0.85rem;  
        color: var(--text-secondary);  
        margin-top: 5px;  
    }  

    .submit-btn {  
        width: 100%;  
        padding: 12px;  
        background: var(--primary-color);  
        color: var(--text-primary);  
        border: 1px solid var(--primary-color);  
        border-radius: 6px;  
        font-size: 1rem;  
        font-weight: 600;  
        cursor: pointer;  
        transition: all 0.3s;  
        font-family: inherit;  
    }  

    .submit-btn:hover:not(:disabled) {  
        background: #cc0000;  
        border-color: #cc0000;  
    }  

    .submit-btn:disabled {  
        opacity: 0.5;  
        cursor: not-allowed;  
    }  

    .status-message {  
        padding: 12px 15px;  
        border-radius: 6px;  
        margin-bottom: 15px;  
        font-size: 0.9rem;  
        display: none;  
    }  

    .status-message.show {  
        display: block;  
    }  

    .status-message.success {  
        background: rgba(0, 255, 0, 0.1);  
        border: 1px solid var(--success-color);  
        color: var(--success-color);  
    }  

    .status-message.error {  
        background: rgba(255, 0, 0, 0.1);  
        border: 1px solid var(--primary-color);  
        color: var(--primary-color);  
    }  

    .status-message.info {  
        background: rgba(29, 161, 242, 0.1);  
        border: 1px solid var(--verified-color);  
        color: var(--verified-color);  
    }  

    .comments-list {  
        display: flex;  
        flex-direction: column;  
        gap: 15px;  
    }  

    .comment-item {  
        background: var(--secondary-color);  
        padding: 15px;  
        border-radius: 8px;  
        border: 1px solid var(--border-color);  
        transition: all 0.3s;  
        cursor: pointer;  
    }  

    .comment-item:hover {  
        border-color: var(--text-secondary);  
    }  

    .comment-item.user-comment {  
        border: 2px solid var(--primary-color);  
        background: rgba(255, 0, 0, 0.05);  
    }  

    .comment-header {  
        display: flex;  
        align-items: center;  
        justify-content: space-between;  
        margin-bottom: 10px;  
    }  

    .comment-author {  
        display: flex;  
        align-items: center;  
        gap: 8px;  
        font-weight: 600;  
        font-size: 0.95rem;  
    }  

    .verified-badge {  
        display: inline-flex;  
        align-items: center;  
        color: var(--verified-color);  
    }  

    .verified-svg {  
        width: 14px;  
        height: 14px;  
        margin-inline-start: 4px;  
    }  

    .comment-time {  
        color: var(--text-secondary);  
        font-size: 0.85rem;  
    }  

    .comment-text {  
        color: var(--text-primary);  
        line-height: 1.6;  
        word-wrap: break-word;  
    }  

    .comment-actions {  
        margin-top: 10px;  
        padding-top: 10px;  
        border-top: 1px solid var(--border-color);  
        font-size: 0.85rem;  
        color: var(--text-secondary);  
    }  

    .click-count {  
        font-weight: 500;  
    }  

    .no-comments {  
        text-align: center;  
        padding: 40px 20px;  
        color: var(--text-secondary);  
    }  

    .loading {  
        text-align: center;  
        padding: 20px;  
        color: var(--text-secondary);  
    }  

    .hidden {  
        display: none;  
    }  

    @media (max-width: 768px) {  
        .container {  
            padding: 15px;  
        }  

        .library-grid {  
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));  
            gap: 15px;  
        }  

        .video-header {  
            flex-direction: column;  
            gap: 10px;  
            align-items: flex-start;  
        }  

        .video-header h1 {  
            font-size: 1.2rem;  
        }  

        .video-title {  
            font-size: 1.1rem;  
        }  

        .comments-header h2 {  
            font-size: 1.2rem;  
        }  

        .comment-form {  
            padding: 15px;  
        }  

        .dub-buttons {  
            flex-direction: column;  
        }  

        .dub-btn {  
            width: 100%;  
            justify-content: center;  
        }  

        .video-controls {  
            width: 100%;  
            justify-content: flex-start;  
        }  

        .delay-control {  
            margin-bottom: 10px;  
        }  

        .sync-controls {  
            flex-wrap: wrap;  
        }  
    }  

    @keyframes fadeIn {  
        from {  
            opacity: 0;  
            transform: translateY(10px);  
        }  
        to {  
            opacity: 1;  
            transform: translateY(0);  
        }  
    }  

    @keyframes pulse {  
        0%, 100% { opacity: 1; }  
        50% { opacity: 0.5; }  
    }  

    .library-item, .comment-item {  
        animation: fadeIn 0.3s ease-out;  
    }  

    .back-btn {  
        display: inline-flex;  
        align-items: center;  
        gap: 5px;  
        background: var(--secondary-color);  
        color: var(--verified-color);  
        border: 1px solid var(--border-color);  
        padding: 8px 15px;  
        border-radius: 6px;  
        cursor: pointer;  
        font-size: 0.9rem;  
        transition: all 0.3s;  
        font-family: inherit;  
        font-weight: 500;  
    }  

    .back-btn:hover {  
        background: var(--primary-color);  
        color: var(--text-primary);  
        border-color: var(--primary-color);  
    }  

    .comments-update-indicator {  
        display: inline-block;  
        width: 8px;  
        height: 8px;  
        background: var(--primary-color);  
        border-radius: 50%;  
        margin-right: 8px;  
        animation: pulse 1.5s ease-in-out infinite;  
    }  

    .comments-update-indicator.paused {  
        animation: none;  
        opacity: 0.5;  
    }  

    #langToggle {  
        position: fixed;  
        right: 20px;  
        bottom: 20px;  
        width: 50px;  
        height: 50px;  
        border-radius: 50%;  
        background: var(--primary-color);  
        color: var(--text-primary);  
        display: flex;  
        align-items: center;  
        justify-content: center;  
        cursor: pointer;  
        z-index: 9999;  
        font-size: 0.7rem;  
        font-weight: 600;  
        border: 2px solid var(--text-primary);  
        transition: all 0.3s;  
        box-shadow: var(--shadow);  
        text-align: center;  
        padding: 5px;  
    }  

    #langToggle:hover {  
        transform: scale(1.1);  
        background: #cc0000;  
    }  

    #langMenu {  
        position: fixed;  
        right: 20px;  
        bottom: 80px;  
        background: var(--bg-light);  
        border: 1px solid var(--border-color);  
        border-radius: 8px;  
        overflow: hidden;  
        z-index: 9999;  
        box-shadow: var(--shadow);  
        min-width: 140px;  
    }  

    #langMenu button {  
        display: block;  
        width: 100%;  
        padding: 12px 16px;  
        background: var(--secondary-color);  
        border: none;  
        color: var(--text-primary);  
        cursor: pointer;  
        text-align: center;  
        transition: all 0.3s;  
        font-size: 0.9rem;  
        font-family: inherit;  
        font-weight: 500;  
    }  

    #langMenu button:hover {  
        background: var(--primary-color);  
        color: var(--text-primary);  
    }  

    #langMenu button.active {  
        background: var(--primary-color);  
        color: var(--text-primary);  
        font-weight: 700;  
    }  

    .spinner {  
        display: inline-block;  
        width: 12px;  
        height: 12px;  
        border: 2px solid rgba(255, 255, 255, 0.3);  
        border-top: 2px solid var(--primary-color);  
        border-radius: 50%;  
        animation: spin 0.8s linear infinite;  
    }  

    @keyframes spin {  
        to { transform: rotate(360deg); }  
    }  

    .reset-sync-btn {  
        width: 36px;  
        height: 36px;  
        border-radius: 6px;  
        border: 2px solid var(--border-color);  
        background: var(--bg-dark);  
        color: var(--text-primary);  
        cursor: pointer;  
        display: flex;  
        align-items: center;  
        justify-content: center;  
        font-size: 1rem;  
        transition: all 0.2s;  
        font-family: inherit;  
        font-weight: 600;  
    }  

    .reset-sync-btn:hover {  
        border-color: var(--success-color);  
        background: var(--bg-light);  
    }  

    .reset-sync-btn:active {  
        transform: scale(0.95);  
    }  
</style>

</head>  
<body>  
    <div class="container">  
        <div class="breadcrumb" id="breadcrumb">  
            <button class="back-btn" id="backBtn" onclick="App.goHome()" style="display: none;"></button>  
            <span id="breadcrumbText">ÿßŸÑŸÖŸÉÿ™ÿ®ÿ©</span>  
        </div>  

        <div id="libraryView" class="library-view">  
            <div class="library-header">  
                <h1 id="libraryTitle">ÿßŸÑŸÖÿ≥ŸÑÿ≥ŸÑÿßÿ™</h1>  
            </div>  
            <div class="library-grid" id="libraryGrid"></div>  
        </div>  

        <div id="videoView" class="hidden">  
            <div class="video-section">  
                <div class="video-header">  
                    <h1>Watch VIP</h1>  
                    <div class="video-controls">  
                        <div class="quick-toggle">  
                            <button id="dubToggle" class="sys-toggle" title="ÿßŸÑÿØÿ®ŸÑÿ¨ÿ©">  
                                <span class="icon">üîá</span>  
                            </button>  
                        </div>  
                    </div>  
                </div>  

                <div class="dub-selector" id="dubSelector" style="display: none;">  
                    <h3 id="dubTitle">ÿßÿÆÿ™ÿ± ŸÜÿ≥ÿÆÿ© ÿßŸÑÿπÿ±ÿ∂:</h3>  
                    <div class="dub-buttons" id="dubButtons"></div>  
                      
                    <div class="delay-control hidden" id="delayControl">  
                        <div class="delay-label">  
                            <span id="delayLabelText">ŸÖÿ≤ÿßŸÖŸÜÿ© ÿßŸÑÿ™ÿ£ÿÆŸäÿ±</span>  
                            <span class="delay-value" id="delayValue">0.0s</span>  
                        </div>  

                        <div class="sync-controls">  
                            <button class="sync-btn" id="nudgeBackBtn" onclick="DubEngine.nudge(-0.1)" title="-0.1s">‚óÄÔ∏é</button>  
                            <input   
                                type="range"   
                                id="delaySlider"   
                                class="delay-slider"   
                                min="0"   
                                max="100"   
                                step="1"   
                                value="50"  
                            >  
                            <button class="sync-btn" id="nudgeForwardBtn" onclick="DubEngine.nudge(0.1)" title="+0.1s">‚ñ∂Ô∏é</button>  
                            <button class="reset-sync-btn" id="resetSyncBtn" onclick="DubEngine.hardReset()" title="ÿ•ÿπÿßÿØÿ© ŸÖÿ≤ÿßŸÖŸÜÿ©">‚ü≤</button>  
                        </div>  

                        <div class="sync-indicator" id="syncIndicator">  
                            <span class="sync-dot"></span>  
                            <span id="syncText">ŸÖÿ≤ÿßŸÖŸÜÿ© ÿ¨ÿßŸáÿ≤ÿ©</span>  
                        </div>  

                        <div class="delay-hint" id="delayHint">ÿßÿ≥ÿ≠ÿ® ÿ£Ÿà ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ™ÿ£ÿÆŸäÿ± ÿ®ŸäŸÜ ÿßŸÑÿµŸàÿ™ ŸàÿßŸÑÿµŸàÿ±ÿ©</div>  
                    </div>  

                    <div class="dub-status-indicator" id="dubStatusIndicator">  
                        <span class="dub-status-dot" id="statusDot"></span>  
                        <span id="statusText">‚ñ∂ ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ© ŸÇŸäÿØ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ</span>  
                    </div>  
                </div>  

                <div class="video-container" id="videoContainer"></div>  

                <div class="video-info">  
                    <h2 class="video-title" id="videoTitle">ÿßŸÑÿπŸÜŸàÿßŸÜ</h2>  
                    <p class="video-description" id="videoDescription">ÿßŸÑŸàÿµŸÅ</p>  
                </div>  
            </div>  

            <div class="comments-section">  
                <div class="comments-header">  
                    <h2>  
                        <span class="comments-update-indicator paused" id="updateIndicator"></span>  
                        <span id="commentsTitle">ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™</span>  
                    </h2>  
                    <span class="comments-count" id="commentsCount">0 ÿ™ÿπŸÑŸäŸÇ</span>  
                </div>  

                <div class="status-message" id="statusMessage"></div>  

                <div class="comment-form">  
                    <form id="commentForm">  
                        <div class="form-group">  
                            <label for="commentName" id="labelName">ÿßŸÑÿßÿ≥ŸÖ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>  
                            <input   
                                type="text"   
                                id="commentName"   
                                maxlength="50"  
                            >  
                            <div class="form-hint" id="hintName">ÿ≥Ÿäÿ™ŸÖ ÿ™ŸàŸÑŸäÿØ ÿßÿ≥ŸÖ ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ•ŸÜ ŸÑŸÖ ÿ™ŸÉÿ™ÿ®</div>  
                        </div>  
                        <div class="form-group">  
                            <label for="commentText" id="labelComment">ÿßŸÑÿ™ÿπŸÑŸäŸÇ *</label>  
                            <textarea   
                                id="commentText"   
                                required  
                                maxlength="500"  
                            ></textarea>  
                        </div>  
                        <button type="submit" class="submit-btn" id="submitBtn">ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ÿπŸÑŸäŸÇ</button>  
                    </form>  
                </div>  

                <div id="commentsListContainer">  
                    <div class="loading" id="loadingText">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div>  
                </div>  
            </div>  
        </div>  
    </div>  

    <div id="langToggle" title="ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©"></div>  
    <div id="langMenu" class="hidden">  
        <button data-lang="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>  
        <button data-lang="en">English</button>  
        <button data-lang="fr">Fran√ßais</button>  
        <button data-lang="ja">Êó•Êú¨Ë™û</button>  
    </div>  

<script>  
    const CONFIG = {  
        BACKEND_URL: 'https://site--watch-vip--j9hb6dlmp4qm.code.run',  
        REFRESH_INTERVAL: 10000,  
        DOUBLE_CLICK_TIMEOUT: 500,  
        SUBMIT_COOLDOWN: 3000,  
        LONG_PRESS_DURATION: 500,  
        SYNC_POLL_INTERVAL: 500,  
        SLIDER_DEBOUNCE: 150,  
        MAX_DELAY: 5,  
        MIN_DELAY: -5  
    };  

    const LIBRARY = {  
        series: [  
            {  
                id: 'doraemon',  
                title: 'ÿØŸàÿ±ÿßŸäŸÖŸàŸÜ',  
                emoji: 'ü§ñ',  
                cover: 'https://images.justwatch.com/backdrop/53298157/s640/doraemon',  
                episodes: [  
                    {  
                        id: 'ep01',  
                        title: 'ÿßŸÑÿ≠ŸÑŸÇÿ© 01 - ÿ®ÿØÿßŸäÿ© ÿØŸàÿ±ÿßŸäŸÖŸàŸÜ',  
                        description: 'ÿßŸÑÿ≠ŸÑŸÇÿ© ÿßŸÑÿ£ŸàŸÑŸâ ŸÖŸÜ ÿßŸÑŸÖÿ≥ŸÑÿ≥ŸÑ ÿßŸÑÿ¥ŸáŸäÿ± ÿ≠Ÿäÿ´ ŸäŸÇÿØŸÖ ÿØŸàÿ±ÿßŸäŸÖŸàŸÜ ŸÜŸÅÿ≥Ÿá ŸÑŸÜŸàÿ®Ÿäÿ™ÿß',  
                        versions: {  
                            original: {  
                                name: 'ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ© (Ÿäÿßÿ®ÿßŸÜŸäÿ©)',  
                                icon: 'üé¨',  
                                id: 'ZYycK1Paq4M',  
                                delay: 0  
                            },  
                            arabic: {  
                                name: 'ÿØÿ®ŸÑÿ¨ÿ© ÿπÿ±ÿ®Ÿäÿ©',  
                                icon: 'üîä',  
                                id: 'oBdv4JrvO6I',  
                                delay: 1  
                            }  
                        }  
                    },  
                    {  
                        id: 'ep02',  
                        title: 'ÿßŸÑÿ≠ŸÑŸÇÿ© 02 - ÿßŸÑÿ¢ŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©',  
                        description: 'ÿØŸàÿ±ÿßŸäŸÖŸàŸÜ ŸäŸÇÿØŸÖ ÿ¢ŸÑÿ™Ÿá ÿßŸÑŸÖŸÖŸäÿ≤ÿ© ÿßŸÑÿ¢ŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ŸÑŸÜŸàÿ®Ÿäÿ™ÿß',  
                        versions: {  
                            original: {  
                                name: 'ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ© (Ÿäÿßÿ®ÿßŸÜŸäÿ©)',  
                                icon: 'üé¨',  
                                id: 'ZYycK1Paq4M',  
                                delay: 0  
                            },  
                            arabic: {  
                                name: 'ÿØÿ®ŸÑÿ¨ÿ© ÿπÿ±ÿ®Ÿäÿ©',  
                                icon: 'üîä',  
                                id: 'oBdv4JrvO6I',  
                                delay: 1  
                            }  
                        }  
                    }  
                ]  
            },  
            {  
                id: 'naruto',  
                title: 'ŸÜÿßÿ±Ÿàÿ™Ÿà',  
                emoji: 'ü•∑',  
                cover: 'https://images.justwatch.com/backdrop/53298157/s640/naruto',  
                episodes: [  
                    {  
                        id: 'naruto_ep01',  
                        title: 'ÿßŸÑÿ≠ŸÑŸÇÿ© 01 - ÿ®ÿØÿßŸäÿ© ÿßŸÑÿ∑ÿ±ŸäŸÇ',  
                        description: 'ŸÜÿßÿ±Ÿàÿ™Ÿà Ÿäÿ®ÿØÿ£ ÿ±ÿ≠ŸÑÿ™Ÿá ŸÑÿ™ÿµÿ®ÿ≠ ŸÜŸäŸÜÿ¨ÿß ŸÇŸàŸäÿßŸã',  
                        versions: {  
                            original: {  
                                name: 'ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ© (Ÿäÿßÿ®ÿßŸÜŸäÿ©)',  
                                icon: 'üé¨',  
                                id: 'ZYycK1Paq4M',  
                                delay: 0  
                            }  
                        }  
                    }  
                ]  
            }  
        ]  
    };  

    const TRANSLATIONS = {  
        ar: {  
            library: 'ÿßŸÑŸÖÿ≥ŸÑÿ≥ŸÑÿßÿ™',  
            back: '‚Üê ÿßŸÑÿ±ÿ¨Ÿàÿπ',  
            comments: 'ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™',  
            commentCount: (n) => `${n} ÿ™ÿπŸÑŸäŸÇ`,  
            labelName: 'ÿßŸÑÿßÿ≥ŸÖ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)',  
            hintName: 'ÿ≥Ÿäÿ™ŸÖ ÿ™ŸàŸÑŸäÿØ ÿßÿ≥ŸÖ ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ•ŸÜ ŸÑŸÖ ÿ™ŸÉÿ™ÿ®',  
            labelComment: 'ÿßŸÑÿ™ÿπŸÑŸäŸÇ *',  
            placeholderName: 'ÿßÿ™ÿ±ŸÉ ŸÅÿßÿ±ÿ∫ÿßŸã ŸÑŸÑÿ™ŸàŸÑŸäÿØ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä',  
            placeholderComment: 'ÿ¥ÿßÿ±ŸÉ ÿ±ÿ£ŸäŸÉ...',  
            submit: 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ÿπŸÑŸäŸÇ',  
            submitting: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ...',  
            noComments: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ÿπŸÑŸäŸÇÿßÿ™ ÿ≠ÿ™Ÿâ ÿßŸÑÿ¢ŸÜ',  
            loading: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...',  
            pending: 'ŸÑÿØŸäŸÉ ÿ™ÿπŸÑŸäŸÇ ŸÇŸäÿØ ÿßŸÑŸÖÿ±ÿßÿ¨ÿπÿ©',  
            empty: 'ÿ£ŸÉŸÖŸÑ ŸÉÿ™ÿßÿ®ÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÇ',  
            success: 'ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ÿπŸÑŸäŸÇŸÉ ÿ®ŸÜÿ¨ÿßÿ≠ ‚úì',  
            error: 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ',  
            canComment: 'ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ™ÿπŸÑŸäŸÇ ŸÖÿ¨ÿØÿØÿßŸã',  
            rateLimitError: 'ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ŸÇŸÑŸäŸÑÿßŸã ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ',  
            langButtonLabel: 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©',  
            dubTitle: 'ÿßÿÆÿ™ÿ± ŸÜÿ≥ÿÆÿ© ÿßŸÑÿπÿ±ÿ∂:',  
            delayLabel: 'ŸÖÿ≤ÿßŸÖŸÜÿ© ÿßŸÑÿ™ÿ£ÿÆŸäÿ±',  
            delayHint: 'ÿßÿ≥ÿ≠ÿ® ÿ£Ÿà ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ™ÿ£ÿÆŸäÿ±',  
            syncReady: 'ŸÖÿ≤ÿßŸÖŸÜÿ© ÿ¨ÿßŸáÿ≤ÿ©',  
            syncing: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ©...'  
        },  
        en: {  
            library: 'Series',  
            back: 'Back',  
            comments: 'Comments',  
            commentCount: (n) => `${n} comment${n !== 1 ? 's' : ''}`,  
            labelName: 'Name (Optional)',  
            hintName: 'An automatic name will be generated if left blank',  
            labelComment: 'Comment *',  
            placeholderName: 'Leave blank for auto-generation',  
            placeholderComment: 'Share your thoughts...',  
            submit: 'Post Comment',  
            submitting: 'Posting...',  
            noComments: 'No comments yet',  
            loading: 'Loading...',  
            pending: 'Your comment is under review',  
            empty: 'Please write a comment',  
            success: 'Comment posted successfully ‚úì',  
            error: 'Failed to send comment',  
            canComment: 'You can comment again',  
            rateLimitError: 'Please wait a moment before posting',  
            langButtonLabel: 'Change Language',  
            dubTitle: 'Choose Version:',  
            delayLabel: 'Sync Delay',  
            delayHint: 'Drag or use buttons to adjust delay',  
            syncReady: 'Sync ready',  
            syncing: 'Syncing...'  
        },  
        fr: {  
            library: 'S√©ries',  
            back: 'Retour',  
            comments: 'Commentaires',  
            commentCount: (n) => `${n} commentaire${n !== 1 ? 's' : ''}`,  
            labelName: 'Nom (Optionnel)',  
            hintName: 'Un nom automatique sera g√©n√©r√© si laiss√© vide',  
            labelComment: 'Commentaire *',  
            placeholderName: 'Laisser vide pour la g√©n√©ration automatique',  
            placeholderComment: 'Partagez vos pens√©es...',  
            submit: 'Publier le commentaire',  
            submitting: 'Publication...',  
            noComments: 'Pas encore de commentaires',  
            loading: 'Chargement...',  
            pending: 'Votre commentaire est en attente',  
            empty: 'Veuillez √©crire un commentaire',  
            success: 'Commentaire publi√© ‚úì',  
            error: 'Erreur lors de l\'envoi',  
            canComment: 'Vous pouvez commenter √† nouveau',  
            rateLimitError: 'Veuillez attendre avant de publier',  
            langButtonLabel: 'Changer la Langue',  
            dubTitle: 'Choisir la version:',  
            delayLabel: 'D√©lai de synchronisation',  
            delayHint: 'Glissez pour ajuster le d√©lai',  
            syncReady: 'Sync pr√™te',  
            syncing: 'Synchronisation...'  
        },  
        ja: {  
            library: '„Ç∑„É™„Éº„Ç∫',  
            back: 'Êàª„Çã',  
            comments: '„Ç≥„É°„É≥„Éà',  
            commentCount: (n) => `${n}‰ª∂„ÅÆ„Ç≥„É°„É≥„Éà`,  
            labelName: 'ÂêçÂâç („Ç™„Éó„Ç∑„Éß„É≥)',  
            hintName: 'Á©∫ÁôΩ„ÅÆ„Åæ„Åæ„Å´„Åô„Çã„Å®„É©„É≥„ÉÄ„É†„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô',  
            labelComment: '„Ç≥„É°„É≥„Éà *',  
            placeholderName: 'Ëá™ÂãïÁîüÊàê„ÅÆ„Åü„ÇÅÁ©∫ÁôΩ„ÅÆ„Åæ„Åæ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ',  
            placeholderComment: '„ÅÇ„Å™„Åü„ÅÆËÄÉ„Åà„ÇíÂÖ±Êúâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...',  
            submit: '„Ç≥„É°„É≥„Éà„ÇíÊäïÁ®ø',  
            submitting: 'ÊäïÁ®ø‰∏≠...',  
            noComments: '„Åæ„Å†„Ç≥„É°„É≥„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì',  
            loading: 'Ë™≠„ÅøËæº„Åø‰∏≠...',  
            pending: '„Ç≥„É°„É≥„Éà„ÅØÂØ©Êüª‰∏≠„Åß„Åô',  
            empty: '„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ',  
            success: '„Ç≥„É°„É≥„Éà„ÅåÊ≠£Â∏∏„Å´ÊäïÁ®ø„Åï„Çå„Åæ„Åó„Åü ‚úì',  
            error: 'ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü',  
            canComment: '„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Ç≥„É°„É≥„Éà„Åß„Åç„Åæ„Åô',  
            rateLimitError: 'ÊäïÁ®ø„Åô„ÇãÂâç„Å´„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ',  
            langButtonLabel: 'Ë®ÄË™û„ÇíÂ§âÊõ¥',  
            dubTitle: '„Éê„Éº„Ç∏„Éß„É≥„ÇíÈÅ∏Êäû:',  
            delayLabel: 'ÂêåÊúüÈÅÖÂª∂',  
            delayHint: '„Çπ„É©„Ç§„ÉÄ„Éº„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶ÈÅÖÂª∂„ÇíË™øÊï¥',  
            syncReady: '„Ç∑„É≥„ÇØÊ∫ñÂÇôÂÆå‰∫Ü',  
            syncing: 'ÂêåÊúü‰∏≠...'  
        }  
    };  

    const Utils = {  
        sanitize(text) {  
            const d = document.createElement('div');  
            d.textContent = text;  
            return d.innerHTML;  
        },  
        timeAgo(ts) {  
            const diff = Date.now() - ts;  
            const m = Math.floor(diff / 60000);  
            const lang = document.documentElement.getAttribute('data-lang');  
              
            const times = {  
                ar: {  
                    now: 'ŸÑŸÑÿ™Ÿà',  
                    minutes: (n) => `ŸÖŸÜÿ∞ ${n} ÿØŸÇŸäŸÇÿ©`,  
                    hours: (n) => `ŸÖŸÜÿ∞ ${n} ÿ≥ÿßÿπÿ©`,  
                    days: (n) => `ŸÖŸÜÿ∞ ${n} ŸäŸàŸÖ`  
                },  
                en: {  
                    now: 'just now',  
                    minutes: (n) => `${n}m ago`,  
                    hours: (n) => `${n}h ago`,  
                    days: (n) => `${n}d ago`  
                },  
                fr: {  
                    now: '√† l\'instant',  
                    minutes: (n) => `il y a ${n}m`,  
                    hours: (n) => `il y a ${n}h`,  
                    days: (n) => `il y a ${n}j`  
                },  
                ja: {  
                    now: '‰ªä',  
                    minutes: (n) => `${n}ÂàÜÂâç`,  
                    hours: (n) => `${n}ÊôÇÈñìÂâç`,  
                    days: (n) => `${n}Êó•Ââç`  
                }  
            };  

            const t = times[lang] || times.en;  
            if (m < 1) return t.now;  
            if (m < 60) return t.minutes(m);  
            const h = Math.floor(m / 60);  
            if (h < 24) return t.hours(h);  
            return t.days(Math.floor(h / 24));  
        },  
        clientId() {  
            let id = localStorage.getItem('watch_vip_client_id');  
            if (!id) {  
                id = Date.now().toString(36) + Math.random().toString(36).slice(2);  
                localStorage.setItem('watch_vip_client_id', id);  
            }  
            return id;  
        },  
        status(msg, type='info') {  
            const el = document.getElementById('statusMessage');  
            el.textContent = msg;  
            el.className = `status-message ${type} show`;  
            setTimeout(()=>el.classList.remove('show'), 4000);  
        },  
        playHaptic() {  
            if (navigator.vibrate) {  
                navigator.vibrate(30);  
            }  
        }  
    };  

    const API = {  
        async submit(name, text) {  
            try {  
                const r = await fetch(`${CONFIG.BACKEND_URL}/submit-comment`, {  
                    method: 'POST',  
                    headers: {'Content-Type':'application/json'},  
                    body: JSON.stringify({  
                        name, text,  
                        clientId: Utils.clientId()  
                    })  
                });  
                if (!r.ok) throw new Error('ŸÅÿ¥ŸÑ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ');  
                return r.json();  
            } catch (e) {  
                throw new Error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ');  
            }  
        },  
        async comments() {  
            try {  
                const r = await fetch(`${CONFIG.BACKEND_URL}/comments`);  
                return r.ok ? r.json() : [];  
            } catch {  
                return [];  
            }  
        }  
    };  

    // ‚úÖ ŸÖÿ≠ÿ±ŸÉ ÿßŸÑÿØÿ®ŸÑÿ¨ÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸëŸÜ - ŸÜÿ≥ÿÆÿ© ŸÖÿ≠ÿ≥ŸëŸÜÿ©
    const DubEngine = {  
        mainFrame: null,  
        audioFrames: {},  
        currentMode: 'original',  
        syncOffset: 0,  
        syncPollInterval: null,  
        customDelays: {},  
        isPlaying: false,  
        customDelaysCached: {},  
        sliderDebounceTimer: null,  

        init(mainId, versions) {  
            const container = document.getElementById('videoContainer');  
            this.stopSyncPoll();  
            this.resetState();  
              
            let html = `<iframe id="dub-main"  
                src="https://www.youtube.com/embed/${mainId}?enablejsapi=1&controls=1&modestbranding=1"  
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"  
                allowfullscreen></iframe>`;  

            Object.entries(versions).forEach(([key, version]) => {  
                if (key !== 'original') {  
                    html += `<iframe id="dub-${key}"  
                        src="https://www.youtube.com/embed/${version.id}?enablejsapi=1&allow=autoplay"  
                        style="display:none"  
                        allow="autoplay; accelerometer"></iframe>`;  
                }  
            });  

            container.innerHTML = html;  
            this.mainFrame = document.getElementById('dub-main');  
              
            Object.keys(versions).forEach(key => {  
                if (key !== 'original') {  
                    this.audioFrames[key] = document.getElementById(`dub-${key}`);  
                }  
            });  

            this.loadCustomDelays();  
        },  

        resetState() {  
            this.currentMode = 'original';  
            this.syncOffset = 0;  
            this.isPlaying = false;  
            this.audioFrames = {};  
            if (this.sliderDebounceTimer) clearTimeout(this.sliderDebounceTimer);  
        },  

        postCommand(frame, action, args = []) {  
            if (!frame) return;  
            try {  
                frame.contentWindow.postMessage(  
                    JSON.stringify({  
                        event: 'command',  
                        func: action,  
                        args: args  
                    }),  
                    '*'  
                );  
            } catch (e) {  
                console.warn('YouTube command failed:', action);  
            }  
        },  

        seek(frame, time) {  
            if (!frame) return;  
            time = Math.max(0, Math.min(time, 10000));  
            this.postCommand(frame, 'seekTo', [time, false]);  
        },  

        play() {  
            this.isPlaying = true;  
              
            if (this.currentMode === 'original') {  
                this.postCommand(this.mainFrame, 'unMute');  
                this.postCommand(this.mainFrame, 'playVideo');  
                this.stopSyncPoll();  
            } else {  
                this.postCommand(this.mainFrame, 'mute');  
                this.postCommand(this.mainFrame, 'playVideo');  
                  
                const audioFrame = this.audioFrames[this.currentMode];  
                if (audioFrame) {  
                    this.postCommand(audioFrame, 'playVideo');  
                    this.startSyncPoll();  
                }  
            }  
        },  

        pause() {  
            this.isPlaying = false;  
            this.stopSyncPoll();  
            this.postCommand(this.mainFrame, 'pauseVideo');  
              
            Object.values(this.audioFrames).forEach(f => {  
                if (f) this.postCommand(f, 'pauseVideo');  
            });  
        },  

        startSyncPoll() {  
            if (this.syncPollInterval) clearInterval(this.syncPollInterval);  
              
            this.syncPollInterval = setInterval(() => {  
                if (this.currentMode !== 'original' && this.isPlaying) {  
                    this.syncDub();  
                }  
            }, CONFIG.SYNC_POLL_INTERVAL);  
        },  

        stopSyncPoll() {  
            if (this.syncPollInterval) {  
                clearInterval(this.syncPollInterval);  
                this.syncPollInterval = null;  
            }  
        },  

        syncDub() {  
            const audioFrame = this.audioFrames[this.currentMode];  
            if (!audioFrame || !this.mainFrame) return;  

            this.postCommand(this.mainFrame, 'getCurrentTime');  
            this.postCommand(audioFrame, 'getCurrentTime');  
        },  

        setMode(mode) {  
            this.currentMode = mode;  
            this.syncOffset = this.customDelays[mode] || 0;  
            this.updateDelaySlider();  
            this.updateSyncIndicator();  
            this.play();  
        },  

        nudge(amount) {  
            this.syncOffset += amount;  
            this.syncOffset = Math.max(CONFIG.MIN_DELAY, Math.min(CONFIG.MAX_DELAY, this.syncOffset));  
            this.setCustomDelay(this.currentMode, this.syncOffset);  
            this.updateDelaySlider();  
            this.updateSyncIndicator();  
            Utils.playHaptic();  
        },  

        hardReset() {  
            const lang = document.documentElement.getAttribute('data-lang');  
            const t = TRANSLATIONS[lang];  
              
            this.syncOffset = 0;  
            this.setCustomDelay(this.currentMode, 0);  
            this.updateDelaySlider();  
            this.updateSyncIndicator();  
            Utils.playHaptic();  
            Utils.status(t.syncReady, 'success');  
        },  

        setCustomDelay(mode, delay) {  
            this.customDelays[mode] = delay;  
            try {  
                localStorage.setItem(`dub_delay_${mode}`, delay);  
            } catch (e) {  
                console.warn('Storage failed');  
            }  
        },  

        loadCustomDelays() {  
            Object.keys(this.audioFrames).forEach(key => {  
                try {  
                    const saved = localStorage.getItem(`dub_delay_${key}`);  
                    if (saved !== null) {  
                        this.customDelays[key] = parseFloat(saved);  
                    }  
                } catch (e) {  
                    console.warn('Load delay failed');  
                }  
            });  
        },  

        updateDelaySlider() {  
            const slider = document.getElementById('delaySlider');  
            const value = document.getElementById('delayValue');  
            if (!slider || !value) return;  
              
            const sliderValue = (this.syncOffset * 10 + 50);  
            slider.value = Math.max(0, Math.min(100, sliderValue)).toString();  
            value.textContent = this.syncOffset.toFixed(1) + 's';  
        },  

        updateSyncIndicator() {  
            const indicator = document.getElementById('syncIndicator');  
            const text = document.getElementById('syncText');  
            const lang = document.documentElement.getAttribute('data-lang');  
            const t = TRANSLATIONS[lang];  

            if (!indicator || !text) return;  

            if (Math.abs(this.syncOffset) > 0.1 || this.currentMode !== 'original') {  
                indicator.classList.add('syncing');  
                text.textContent = t.syncing;  
            } else {  
                indicator.classList.remove('syncing');  
                text.textContent = t.syncReady;  
            }  
        }  
    };  

    const App = {  
        currentView: 'home',  
        currentSeries: null,  
        currentEpisode: null,  
        dubEnabled: false,  
        lastDubMode: localStorage.getItem('last_dub') || 'arabic',  
        longPressTimer: null,  
        dubSelectorVisible: false,  

        init() {  
            this.renderHome();  
            Comments.init();  
            this.setupDubToggle();  
        },  

        setupDubToggle() {  
            const btn = document.getElementById('dubToggle');  
            if (!btn) return;  
              
            let touchStartTime = 0;  
            let isLongPress = false;  
              
            const handleLongPress = () => {  
                if (App.currentView !== 'video') return;  
                isLongPress = true;  
                Utils.playHaptic();  
                App.toggleDubSelector();  
            };  

            const handleClick = () => {  
                if (App.currentView !== 'video') return;  
                if (isLongPress) {  
                    isLongPress = false;  
                    return;  
                }  
                App.toggleDub();  
            };  

            btn.addEventListener('mousedown', () => {  
                if (App.currentView !== 'video') return;  
                touchStartTime = Date.now();  
                this.longPressTimer = setTimeout(handleLongPress, CONFIG.LONG_PRESS_DURATION);  
            });  

            btn.addEventListener('mouseup', () => {  
                if (this.longPressTimer) clearTimeout(this.longPressTimer);  
                if (Date.now() - touchStartTime < CONFIG.LONG_PRESS_DURATION) {  
                    handleClick();  
                }  
            });  

            btn.addEventListener('touchstart', () => {  
                if (App.currentView !== 'video') return;  
                touchStartTime = Date.now();  
                isLongPress = false;  
                this.longPressTimer = setTimeout(handleLongPress, CONFIG.LONG_PRESS_DURATION);  
            });  

            btn.addEventListener('touchend', () => {  
                if (this.longPressTimer) clearTimeout(this.longPressTimer);  
                if (Date.now() - touchStartTime < CONFIG.LONG_PRESS_DURATION && !isLongPress) {  
                    handleClick();  
                }  
                isLongPress = false;  
            });  
        },  

        toggleDub() {  
            Utils.playHaptic();  
            this.dubEnabled = !this.dubEnabled;  
              
            if (this.dubEnabled) {  
                document.getElementById('dubToggle').classList.add('active');  
                document.getElementById('dubToggle').querySelector('.icon').textContent = 'üîä';  
                DubEngine.setMode(this.lastDubMode);  
            } else {  
                document.getElementById('dubToggle').classList.remove('active');  
                document.getElementById('dubToggle').querySelector('.icon').textContent = 'üîá';  
                DubEngine.setMode('original');  
            }  
        },  

        toggleDubSelector() {  
            const selector = document.getElementById('dubSelector');  
            this.dubSelectorVisible = !this.dubSelectorVisible;  
              
            if (this.dubSelectorVisible) {  
                selector.style.display = 'block';  
                selector.scrollIntoView({ behavior: 'smooth', block: 'nearest' });  
            } else {  
                selector.style.display = 'none';  
            }  
        },  

        renderHome() {  
            const lang = document.documentElement.getAttribute('data-lang');  
            const t = TRANSLATIONS[lang];  

            document.getElementById('libraryView').classList.remove('hidden');  
            document.getElementById('videoView').classList.add('hidden');  
            document.getElementById('backBtn').style.display = 'none';  
            document.getElementById('breadcrumbText').textContent = t.library;  

            const grid = document.getElementById('libraryGrid');  
            grid.innerHTML = LIBRARY.series.map(series => `  
                <div class="library-item" onclick="App.viewSeries('${series.id}')">  
                    <div class="item-cover">  
                        ${series.emoji}  
                    </div>  
                    <div class="item-info">  
                        <div class="item-title">${Utils.sanitize(series.title)}</div>  
                        <div class="item-subtitle">${series.episodes.length} ÿ≠ŸÑŸÇÿ©</div>  
                    </div>  
                </div>  
            `).join('');  

            this.currentView = 'home';  
            this.dubSelectorVisible = false;  
            DubEngine.stopSyncPoll();  
            Comments.pauseAutoRefresh();  
        },  

        viewSeries(seriesId) {  
            const lang = document.documentElement.getAttribute('data-lang');  
            const t = TRANSLATIONS[lang];  

            this.currentSeries = LIBRARY.series.find(s => s.id === seriesId);  
            if (!this.currentSeries) return;  

            document.getElementById('libraryView').classList.remove('hidden');  
            document.getElementById('videoView').classList.add('hidden');  
            document.getElementById('backBtn').style.display = 'inline-flex';  
            document.getElementById('backBtn').textContent = t.back;  
            document.getElementById('libraryTitle').textContent = this.currentSeries.title;  
            document.getElementById('breadcrumbText').textContent = this.currentSeries.title;  

            const grid = document.getElementById('libraryGrid');  
            grid.innerHTML = this.currentSeries.episodes.map(ep => `  
                <div class="library-item" onclick="App.playEpisode('${ep.id}')">  
                    <div class="item-cover episode">  
                        <span>‚ñ∂</span>  
                    </div>  
                    <div class="item-info">  
                        <div class="item-title">${Utils.sanitize(ep.title)}</div>  
                        <div class="item-subtitle">${Utils.sanitize(ep.description)}</div>  
                    </div>  
                </div>  
            `).join('');  

            this.currentView = 'series';  
            this.dubSelectorVisible = false;  
            DubEngine.stopSyncPoll();  
            Comments.pauseAutoRefresh();  
        },  

        playEpisode(episodeId) {  
            const lang = document.documentElement.getAttribute('data-lang');  
            const t = TRANSLATIONS[lang];  

            if (!this.currentSeries) return;  
            this.currentEpisode = this.currentSeries.episodes.find(e => e.id === episodeId);  
            if (!this.currentEpisode) return;  

            document.getElementById('libraryView').classList.add('hidden');  
            document.getElementById('videoView').classList.remove('hidden');  
            document.getElementById('backBtn').style.display = 'inline-flex';  
            document.getElementById('backBtn').textContent = t.back;  
            document.getElementById('breadcrumbText').textContent = this.currentEpisode.title;  

            document.getElementById('videoTitle').textContent = this.currentEpisode.title;  
            document.getElementById('videoDescription').textContent = this.currentEpisode.description;  

            const mainId = this.currentEpisode.versions.original.id;  
            DubEngine.init(mainId, this.currentEpisode.versions);  
            this.setupDubButtons();  

            this.dubEnabled = false;  
            this.dubSelectorVisible = false;  
            document.getElementById('dubToggle').classList.remove('active');  
            document.getElementById('dubToggle').querySelector('.icon').textContent = 'üîá';  

            this.currentView = 'video';  
            Comments.load();  
        },  

        setupDubButtons() {  
            const lang = document.documentElement.getAttribute('data-lang');  
            const t = TRANSLATIONS[lang];  
            const versions = this.currentEpisode.versions;  
            const dubButtons = document.getElementById('dubButtons');  
            const dubSelector = document.getElementById('dubSelector');  

            if (!versions || Object.keys(versions).length <= 1) {  
                dubSelector.style.display = 'none';  
                return;  
            }  

            dubSelector.style.display = 'none';  
            this.dubSelectorVisible = false;  
            document.getElementById('dubTitle').textContent = t.dubTitle;  

            dubButtons.innerHTML = Object.entries(versions).map(([key, version]) => `  
                <button   
                    class="dub-btn ${key === 'original' ? 'active' : ''}"   
                    onclick="App.selectDubVersion('${key}', this)"  
                >  
                    <span class="dub-icon">${version.icon}</span>  
                    <span>${version.name}</span>  
                </button>  
            `).join('');  

            const delaySlider = document.getElementById('delaySlider');  
            if (delaySlider) {  
                delaySlider.oninput = () => {  
                    if (DubEngine.sliderDebounceTimer) {  
                        clearTimeout(DubEngine.sliderDebounceTimer);  
                    }  
                      
                    DubEngine.sliderDebounceTimer = setTimeout(() => {  
                        const offset = (delaySlider.value - 50) / 10;  
                        DubEngine.syncOffset = offset;  
                        DubEngine.setCustomDelay(DubEngine.currentMode, offset);  
                        DubEngine.updateDelaySlider();  
                    }, CONFIG.SLIDER_DEBOUNCE);  
                };  
            }  

            this.updateStatusIndicator('original');  
        },  

        updateStatusIndicator(mode) {  
            const statusText = document.getElementById('statusText');  
            const statusDot = document.getElementById('statusDot');  
            const delayControl = document.getElementById('delayControl');  
            const lang = document.documentElement.getAttribute('data-lang');  
              
            const statusMessages = {  
                ar: {  
                    original: '‚ñ∂ ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ© ŸÇŸäÿØ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ',  
                    arabic: 'üîä ÿßŸÑÿØÿ®ŸÑÿ¨ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ŸÖŸÅÿπŸÑÿ©',  
                    japanese: 'üéå ÿßŸÑÿØÿ®ŸÑÿ¨ÿ© ÿßŸÑŸäÿßÿ®ÿßŸÜŸäÿ© ŸÖŸÅÿπŸÑÿ©'  
                },  
                en: {  
                    original: '‚ñ∂ Original version is playing',  
                    arabic: 'üîä Arabic dub is enabled',  
                    japanese: 'üéå Japanese dub is enabled'  
                },  
                fr: {  
                    original: '‚ñ∂ La version originale',  
                    arabic: 'üîä Doublage arabe',  
                    japanese: 'üéå Doublage japonais'  
                },  
                ja: {  
                    original: '‚ñ∂ „Ç™„É™„Ç∏„Éä„É´Áâà',  
                    arabic: 'üîä „Ç¢„É©„Éì„Ç¢Ë™ûÂêπÊõø',  
                    japanese: 'üéå Êó•Êú¨Ë™ûÂêπÊõø'  
                }  
            };  

            const messages = statusMessages[lang] || statusMessages.en;  
            if (statusText) statusText.textContent = messages[mode] || messages.original;  

            if (statusDot) {  
                if (mode === 'original') {  
                    statusDot.classList.remove('active');  
                } else {  
                    statusDot.classList.add('active');  
                }  
            }  

            if (delayControl) {  
                if (mode === 'original') {  
                    delayControl.classList.add('hidden');  
                } else {  
                    delayControl.classList.remove('hidden');  
                    DubEngine.updateDelaySlider();  
                }  
            }  
        },  

        selectDubVersion(versionKey, button) {  
            Utils.playHaptic();  
              
            document.querySelectorAll('.dub-btn').forEach(btn => {  
                btn.classList.remove('active');  
            });  
            button.classList.add('active');  

            this.updateStatusIndicator(versionKey);  

            if (versionKey === 'original') {  
                this.dubEnabled = false;  
                document.getElementById('dubToggle').classList.remove('active');  
                document.getElementById('dubToggle').querySelector('.icon').textContent = 'üîá';  
                DubEngine.setMode('original');  
            } else {  
                this.lastDubMode = versionKey;  
                localStorage.setItem('last_dub', versionKey);  
                this.dubEnabled = true;  
                document.getElementById('dubToggle').classList.add('active');  
                document.getElementById('dubToggle').querySelector('.icon').textContent = 'üîä';  
                DubEngine.setMode(versionKey);  
            }  
        },  

        goHome() {  
            if (this.currentView === 'video') {  
                this.viewSeries(this.currentSeries.id);  
            } else if (this.currentView === 'series') {  
                this.renderHome();  
            }  
        }  
    };  

    const Comments = {  
        userCommentId: localStorage.getItem('watch_vip_user_comment_id'),  
        autoRefreshInterval: null,  
        isRefreshing: false,  
        lastSubmitTime: 0,  

        async init() {  
            const form = document.getElementById('commentForm');  
            if (form) {  
                form.addEventListener('submit', e => {  
                    e.preventDefault();  
                    this.send();  
                });  
            }  
            await this.load();  
            this.startAutoRefresh();  
        },  

        startAutoRefresh() {  
            if (this.autoRefreshInterval) clearInterval(this.autoRefreshInterval);  
              
            this.autoRefreshInterval = setInterval(() => {  
                if (App.currentView === 'video') {  
                    this.load();  
                }  
            }, CONFIG.REFRESH_INTERVAL);  
        },  

        pauseAutoRefresh() {  
            const indicator = document.getElementById('updateIndicator');  
            if (indicator) {  
                if (App.currentView === 'video') {  
                    indicator.classList.remove('paused');  
                } else {  
                    indicator.classList.add('paused');  
                }  
            }  
        },  

        async send() {  
            const lang = document.documentElement.getAttribute('data-lang');  
            const t = TRANSLATIONS[lang];  
            const now = Date.now();  

            if (now - this.lastSubmitTime < CONFIG.SUBMIT_COOLDOWN) {  
                Utils.status(t.rateLimitError, 'error');  
                return;  
            }  

            if (this.userCommentId) {  
                Utils.status(t.pending, 'info');  
                return;  
            }  

            const name = document.getElementById('commentName').value.trim();  
            const text = document.getElementById('commentText').value.trim();  
              
            if (!text) {  
                Utils.status(t.empty, 'error');  
                return;  
            }  

            const btn = document.getElementById('submitBtn');  
            btn.disabled = true;  
            btn.textContent = '‚è≥ ' + t.submitting;  

            try {  
                const res = await API.submit(name || null, text);  
                this.userCommentId = res.commentId;  
                localStorage.setItem('watch_vip_user_comment_id', res.commentId);  
                this.lastSubmitTime = now;  
                Utils.status(t.success, 'success');  
                Utils.playHaptic();  
                document.getElementById('commentText').value = '';  
                document.getElementById('commentName').value = '';  
                await this.load();  
            } catch (e) {  
                Utils.status(t.error, 'error');  
            } finally {  
                btn.disabled = false;  
                btn.textContent = t.submit;  
            }  
        },  

        async load() {  
            if (this.isRefreshing) return;  
            this.isRefreshing = true;  

            try {  
                const lang = document.documentElement.getAttribute('data-lang');  
                const t = TRANSLATIONS[lang];  
                const list = await API.comments();  
                const box = document.getElementById('commentsListContainer');  

                if (!box) {  
                    this.isRefreshing = false;  
                    return;  
                }  

                document.getElementById('commentsCount').textContent = t.commentCount(list.length);  

                if (!list.length) {  
                    box.innerHTML = `<div class="no-comments">${t.noComments}</div>`;  
                    this.isRefreshing = false;  
                    return;  
                }  

                if (this.userCommentId && list.length > 0 && !list.some(c => c.commentId === this.userCommentId)) {  
                    localStorage.removeItem('watch_vip_user_comment_id');  
                    this.userCommentId = null;  
                }  

                list.sort((a,b)=>{  
                    if (a.commentId === this.userCommentId) return -1;  
                    if (b.commentId === this.userCommentId) return 1;  
                    return b.timestamp - a.timestamp;  
                });  

                box.innerHTML = `  
                    <div class="comments-list">  
                        ${list.map(c=>`  
                            <div class="comment-item ${c.commentId===this.userCommentId?'user-comment':''}" data-id="${c.commentId}">  
                                <div class="comment-header">  
                                    <div class="comment-author">  
                                        ${Utils.sanitize(c.displayName)}  
                                        ${c.verified ? `<svg class="verified-svg" viewBox="0 0 24 24" fill="#1da1f2"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>` : ''}  
                                    </div>  
                                    <span class="comment-time">${Utils.timeAgo(c.timestamp)}</span>  
                                </div>  
                                <div class="comment-text">${Utils.sanitize(c.text)}</div>  
                            </div>  
                        `).join('')}  
                    </div>  
                `;  

                this.bindClicks();  
            } finally {  
                this.isRefreshing = false;  
            }  
        },  

        bindClicks() {  
            const lang = document.documentElement.getAttribute('data-lang');  
            const t = TRANSLATIONS[lang];  

            document.querySelectorAll('.user-comment').forEach(el=>{  
                let last = 0;  
                el.onclick = () => {  
                    const now = Date.now();  
                    if (now - last < CONFIG.DOUBLE_CLICK_TIMEOUT) {  
                        localStorage.removeItem('watch_vip_user_comment_id');  
                        this.userCommentId = null;  
                        Utils.status(t.canComment, 'success');  
                        Utils.playHaptic();  
                        this.load();  
                    }  
                    last = now;  
                };  
            });  
        }  
    };  

    function applyLanguage(lang) {  
        const t = TRANSLATIONS[lang];  
        document.documentElement.setAttribute('data-lang', lang);  
        localStorage.setItem('site_lang', lang);  

        const el = (id) => document.getElementById(id);  
        if (el('libraryTitle')) el('libraryTitle').textContent = t.library;  
        if (el('breadcrumbText')) el('breadcrumbText').textContent = t.library;  
        if (el('backBtn')) el('backBtn').textContent = t.back;  
        if (el('commentsTitle')) el('commentsTitle').textContent = t.comments;  
        if (el('labelName')) el('labelName').textContent = t.labelName;  
        if (el('hintName')) el('hintName').textContent = t.hintName;  
        if (el('labelComment')) el('labelComment').textContent = t.labelComment;  
        if (el('commentName')) el('commentName').placeholder = t.placeholderName;  
        if (el('commentText')) el('commentText').placeholder = t.placeholderComment;  
        if (el('submitBtn')) el('submitBtn').textContent = t.submit;  
        if (el('loadingText')) el('loadingText').textContent = t.loading;  
        if (el('dubTitle')) el('dubTitle').textContent = t.dubTitle;  
        if (el('delayLabelText')) el('delayLabelText').textContent = t.delayLabel;  
        if (el('delayHint')) el('delayHint').textContent = t.delayHint;  

        const langButton = document.getElementById('langToggle');  
        const langLabels = {ar: 'ÿßŸÑŸÑÿ∫ÿ©', en: 'Lang', fr: 'Langue', ja: 'Ë®ÄË™û'};  
        if (langButton) langButton.textContent = langLabels[lang] || 'Lang';  

        document.querySelectorAll('#langMenu button').forEach(btn => {  
            btn.classList.remove('active');  
            if (btn.dataset.lang === lang) btn.classList.add('active');  
        });  

        if (App.currentView === 'video') Comments.load();  
    }  

    const langToggle = document.getElementById('langToggle');  
    const langMenu = document.getElementById('langMenu');  

    if (langToggle && langMenu) {  
        langToggle.onclick = (e) => {  
            e.stopPropagation();  
            langMenu.classList.toggle('hidden');  
        };  

        langMenu.querySelectorAll('button').forEach(btn => {  
            btn.onclick = () => {  
                applyLanguage(btn.dataset.lang);  
                langMenu.classList.add('hidden');  
                Utils.playHaptic();  
            };  
        });  

        document.addEventListener('click', (e) => {  
            if (!e.target.closest('#langToggle') && !e.target.closest('#langMenu')) {  
                langMenu.classList.add('hidden');  
            }  
        });  
    }  

    const savedLang = localStorage.getItem('site_lang') || 'ar';  
    applyLanguage(savedLang);  

    document.addEventListener('DOMContentLoaded', ()=>App.init());  
</script>

</body>  
</html>
